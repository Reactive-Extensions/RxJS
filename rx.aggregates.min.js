/*** @preserve Copyright (c) Microsoft Corporation.  All rights reserved.
* This code is licensed by Microsoft Corporation under the terms
* of the MICROSOFT REACTIVE EXTENSIONS FOR JAVASCRIPT AND .NET LIBRARIES License.
* See http://go.microsoft.com/fwlink/?LinkID=220762.
*/
(function(e,t){var n=typeof exports=="object"&&exports&&(typeof e=="object"&&e&&e==e.global&&(window=e),exports);typeof define=="function"&&define.amd?define(["rx","exports"],function(n,r){return e.Rx=t(e,r,n),e.Rx}):typeof module=="object"&&module&&module.exports==n?module.exports=t(e,module.exports,require("./rx")):e.Rx=t(e,{},e.Rx)})(this,function(e,t,n,r){function l(e,t){return e===t}function c(e){return e}function h(e,t){return e>t?1:e===t?0:-1}function p(e,t,n){return new u(function(r){var i=!1,s=null,o=[];return e.subscribe(function(e){var u,a;try{a=t(e)}catch(f){r.onError(f);return}u=0;if(!i)i=!0,s=a;else try{u=n(a,s)}catch(l){r.onError(l);return}u>0&&(s=a,o=[]),u>=0&&o.push(e)},r.onError.bind(r),function(){r.onNext(o),r.onCompleted()})})}function d(e){if(e.length==0)throw new Error(f);return e[0]}function v(e,t,n){return new u(function(r){var i=0,s=t.length;return e.subscribe(function(e){var o=!1;try{i<s&&(o=n(e,t[i++]))}catch(u){r.onError(u);return}o||(r.onNext(!1),r.onCompleted())},r.onError.bind(r),function(){r.onNext(i===s),r.onCompleted()})})}function m(e,t,n,r){if(t<0)throw new Error(a);return new u(function(i){var s=t;return e.subscribe(function(e){s===0&&(i.onNext(e),i.onCompleted()),s--},i.onError.bind(i),function(){n?(i.onNext(r),i.onCompleted()):i.onError(new Error(a))})})}function g(e,t,n){return new u(function(r){var i=n,s=!1;return e.subscribe(function(e){s?r.onError(new Error("Sequence contains more than one element")):(i=e,s=!0)},r.onError.bind(r),function(){!s&&!t?r.onError(new Error(f)):(r.onNext(i),r.onCompleted())})})}function y(e,t,n){return new u(function(r){return e.subscribe(function(e){r.onNext(e),r.onCompleted()},r.onError.bind(r),function(){t?(r.onNext(n),r.onCompleted()):r.onError(new Error(f))})})}function b(e,t,n){return new u(function(r){var i=n,s=!1;return e.subscribe(function(e){i=e,s=!0},r.onError.bind(r),function(){!s&&!t?r.onError(new Error(f)):(r.onNext(i),r.onCompleted())})})}var i=n.Observable,s=i.prototype,o=n.CompositeDisposable,u=n.Internals.AnonymousObservable,a="Argument out of range",f="Sequence contains no elements.";return s.aggregate=function(){var e,t,n;return arguments.length===2?(e=arguments[0],t=!0,n=arguments[1]):n=arguments[0],t?this.scan(e,n).startWith(e).finalValue():this.scan(n).finalValue()},s.any=function(e){var t=this;return e?t.where(e).any():new u(function(e){return t.subscribe(function(){e.onNext(!0),e.onCompleted()},e.onError.bind(e),function(){e.onNext(!1),e.onCompleted()})})},s.isEmpty=function(){return this.any().select(function(e){return!e})},s.all=function(e){return this.where(function(t){return!e(t)}).any().select(function(e){return!e})},s.contains=function(e,t){return t||(t=l),this.where(function(n){return t(n,e)}).any()},s.count=function(e){return e?this.where(e).count():this.aggregate(0,function(e){return e+1})},s.sum=function(e){return e?this.select(e).sum():this.aggregate(0,function(e,t){return e+t})},s.minBy=function(e,t){return t||(t=h),p(this,e,function(e,n){return t(e,n)*-1})},s.min=function(e){return this.minBy(c,e).select(function(e){return d(e)})},s.maxBy=function(e,t){return t||(t=h),p(this,e,t)},s.max=function(e){return this.maxBy(c,e).select(function(e){return d(e)})},s.average=function(e){return e?this.select(e).average():this.scan({sum:0,count:0},function(e,t){return{sum:e.sum+t,count:e.count+1}}).finalValue().select(function(e){return e.sum/e.count})},s.sequenceEqual=function(e,t){var n=this;return t||(t=l),Array.isArray(e)?v(n,e,t):new u(function(r){var i=!1,s=!1,u=[],a=[],f=n.subscribe(function(e){var n,i;if(a.length>0){i=a.shift();try{n=t(i,e)}catch(o){r.onError(o);return}n||(r.onNext(!1),r.onCompleted())}else s?(r.onNext(!1),r.onCompleted()):u.push(e)},r.onError.bind(r),function(){i=!0,u.length===0&&(a.length>0?(r.onNext(!1),r.onCompleted()):s&&(r.onNext(!0),r.onCompleted()))}),l=e.subscribe(function(e){var n,s;if(u.length>0){s=u.shift();try{n=t(s,e)}catch(o){r.onError(o);return}n||(r.onNext(!1),r.onCompleted())}else i?(r.onNext(!1),r.onCompleted()):a.push(e)},r.onError.bind(r),function(){s=!0,a.length===0&&(u.length>0?(r.onNext(!1),r.onCompleted()):i&&(r.onNext(!0),r.onCompleted()))});return new o(f,l)})},s.elementAt=function(e){return m(this,e,!1)},s.elementAtOrDefault=function(e,t){return m(this,e,!0,t)},s.single=function(e){return e?this.where(e).single():g(this,!1)},s.singleOrDefault=function(e,t){return e?this.where(e).singleOrDefault(null,t):g(this,!0,t)},s.first=function(e){return e?this.where(e).first():y(this,!1)},s.firstOrDefault=function(e,t){return e?this.where(e).firstOrDefault(null,t):y(this,!0,t)},s.last=function(e){return e?this.where(e).last():b(this,!1)},s.lastOrDefault=function(e,t){return e?this.where(e).lastOrDefault(null,t):b(this,!0,t)},n});