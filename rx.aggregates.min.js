(function(t,e){var n="object"==typeof exports&&exports&&("object"==typeof t&&t&&t===t.global&&(window=t),exports);"function"==typeof define&&define.amd?define(["rx","exports"],function(n,r){return t.Rx=e(t,r,n),t.Rx}):"object"==typeof module&&module&&module.exports===n?module.exports=e(t,module.exports,require("./rx")):t.Rx=e(t,{},t.Rx)})(this,function(t,e,n,r){function o(t,e){return t===e}function s(t){return t}function u(t,e){return t>e?1:t===e?0:-1}function c(t,e,n){return new w(function(i){var o=!1,s=null,u=[];return t.subscribe(function(t){var c,a;try{a=e(t)}catch(h){return i.onError(h),r}if(c=0,o)try{c=n(a,s)}catch(l){return i.onError(l),r}else o=!0,s=a;c>0&&(s=a,u=[]),c>=0&&u.push(t)},i.onError.bind(i),function(){i.onNext(u),i.onCompleted()})})}function a(t){if(0==t.length)throw Error(E);return t[0]}function h(t,e,n){return new w(function(i){var o=0,s=e.length;return t.subscribe(function(t){var u=!1;try{s>o&&(u=n(t,e[o++]))}catch(c){return i.onError(c),r}u||(i.onNext(!1),i.onCompleted())},i.onError.bind(i),function(){i.onNext(o===s),i.onCompleted()})})}function l(t,e,n,r){if(0>e)throw Error(g);return new w(function(i){var o=e;return t.subscribe(function(t){0===o&&(i.onNext(t),i.onCompleted()),o--},i.onError.bind(i),function(){n?(i.onNext(r),i.onCompleted()):i.onError(Error(g))})})}function f(t,e,n){return new w(function(r){var i=n,o=!1;return t.subscribe(function(t){o?r.onError(Error("Sequence contains more than one element")):(i=t,o=!0)},r.onError.bind(r),function(){o||e?(r.onNext(i),r.onCompleted()):r.onError(Error(E))})})}function p(t,e,n){return new w(function(r){return t.subscribe(function(t){r.onNext(t),r.onCompleted()},r.onError.bind(r),function(){e?(r.onNext(n),r.onCompleted()):r.onError(Error(E))})})}function d(t,e,n){return new w(function(r){var i=n,o=!1;return t.subscribe(function(t){i=t,o=!0},r.onError.bind(r),function(){o||e?(r.onNext(i),r.onCompleted()):r.onError(Error(E))})})}function b(t,e,n,o){return new w(function(s){return t.subscribe(function(r){e.call(n,r,i,t)?(s.onNext(o?i:r),s.onCompleted()):i++},s.onError.bind(s),function(){s.onNext(o?-1:r),s.onCompleted()})})}var v=n.Observable,m=v.prototype,y=n.CompositeDisposable,w=n.Internals.AnonymousObservable,g="Argument out of range",E="Sequence contains no elements.";return m.aggregate=function(){var t,e,n;return 2===arguments.length?(t=arguments[0],e=!0,n=arguments[1]):n=arguments[0],e?this.scan(t,n).startWith(t).finalValue():this.scan(n).finalValue()},m.reduce=function(){var t,e,n=arguments[0];return 2===arguments.length&&(e=!0,t=arguments[1]),e?this.scan(t,n).startWith(t).finalValue():this.scan(n).finalValue()},m.any=function(t,e){var n=this;return t?n.where(t,e).any():new w(function(t){return n.subscribe(function(){t.onNext(!0),t.onCompleted()},t.onError.bind(t),function(){t.onNext(!1),t.onCompleted()})})},m.some=m.any,m.isEmpty=function(){return this.any().select(function(t){return!t})},m.all=function(t,e){return this.where(function(e){return!t(e)},e).any().select(function(t){return!t})},m.every=m.all,m.contains=function(t,e){return e||(e=o),this.where(function(n){return e(n,t)}).any()},m.count=function(t){return t?this.where(t).count():this.aggregate(0,function(t){return t+1})},m.sum=function(t){return t?this.select(t).sum():this.aggregate(0,function(t,e){return t+e})},m.minBy=function(t,e){return e||(e=u),c(this,t,function(t,n){return-1*e(t,n)})},m.min=function(t){return this.minBy(s,t).select(function(t){return a(t)})},m.maxBy=function(t,e){return e||(e=u),c(this,t,e)},m.max=function(t){return this.maxBy(s,t).select(function(t){return a(t)})},m.average=function(t){return t?this.select(t).average():this.scan({sum:0,count:0},function(t,e){return{sum:t.sum+e,count:t.count+1}}).finalValue().select(function(t){return t.sum/t.count})},m.sequenceEqual=function(t,e){var n=this;return e||(e=o),Array.isArray(t)?h(n,t,e):new w(function(i){var o=!1,s=!1,u=[],c=[],a=n.subscribe(function(t){var n,o;if(c.length>0){o=c.shift();try{n=e(o,t)}catch(a){return i.onError(a),r}n||(i.onNext(!1),i.onCompleted())}else s?(i.onNext(!1),i.onCompleted()):u.push(t)},i.onError.bind(i),function(){o=!0,0===u.length&&(c.length>0?(i.onNext(!1),i.onCompleted()):s&&(i.onNext(!0),i.onCompleted()))}),h=t.subscribe(function(t){var n,s;if(u.length>0){s=u.shift();try{n=e(s,t)}catch(a){return i.onError(a),r}n||(i.onNext(!1),i.onCompleted())}else o?(i.onNext(!1),i.onCompleted()):c.push(t)},i.onError.bind(i),function(){s=!0,0===c.length&&(u.length>0?(i.onNext(!1),i.onCompleted()):o&&(i.onNext(!0),i.onCompleted()))});return new y(a,h)})},m.elementAt=function(t){return l(this,t,!1)},m.elementAtOrDefault=function(t,e){return l(this,t,!0,e)},m.single=function(t){return t?this.where(t).single():f(this,!1)},m.singleOrDefault=function(t,e){return t?this.where(t).singleOrDefault(null,e):f(this,!0,e)},m.first=function(t){return t?this.where(t).first():p(this,!1)},m.firstOrDefault=function(t,e){return t?this.where(t).firstOrDefault(null,e):p(this,!0,e)},m.last=function(t){return t?this.where(t).last():d(this,!1)},m.lastOrDefault=function(t,e){return t?this.where(t).lastOrDefault(null,e):d(this,!0,e)},m.find=function(t){return b(this,t,arguments[1],!1)},m.findIndex=function(t){return b(this,t,arguments[1],!0)},n});