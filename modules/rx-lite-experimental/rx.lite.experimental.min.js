/* Copyright (c) Microsoft Open Technologies, Inc. All rights reserved. See License.txt in the project root for license information.*/
(function(a){var b={"function":!0,object:!0},c=b[typeof exports]&&exports&&!exports.nodeType&&exports,d=b[typeof self]&&self.Object&&self,e=b[typeof window]&&window&&window.Object&&window,f=b[typeof module]&&module&&!module.nodeType&&module,g=(f&&f.exports===c&&c,c&&f&&"object"==typeof global&&global&&global.Object&&global),h=h=g||e!==(this&&this.window)&&e||d||this;"function"==typeof define&&define.amd?define(["./rx.lite"],function(b,c){return a(h,c,b)}):"object"==typeof module&&module&&module.exports===c?module.exports=a(h,module.exports,require("rx-lite")):h.Rx=a(h,{},h.Rx)}).call(this,function(a,b,c,d){function f(a){return function(){try{return a.apply(this,arguments)}catch(b){return H.e=b,H}}}function g(a,b){return new K(a,b)}var h=c.Observable,i=h.prototype,j=c.AnonymousObservable,k=c.FlatMapObservable,l=h.concat,m=h.defer,n=h.empty,o=c.Disposable.empty,p=c.CompositeDisposable,q=c.BinaryDisposable,r=c.SerialDisposable,s=c.SingleAssignmentDisposable,t=c.internals.Enumerable,u=t.of,v=c.Scheduler.immediate,w=c.Scheduler.currentThread,x=c.AsyncSubject,y=c.Observer,z=c.internals.inherits,A=c.internals.addProperties,B=c.helpers,C=B.noop,D=B.isPromise,E=B.isFunction,F=(c.helpers.isIterable,c.helpers.isArrayLike,c.Scheduler.isScheduler),G=h.fromPromise,H={e:{}},I=c.internals.tryCatch=function(a){if(!E(a))throw new TypeError("fn must be a function");return f(a)},J="function"==typeof Symbol&&Symbol.iterator||"_es6shim_iterator_";a.Set&&"function"==typeof(new a.Set)["@@iterator"]&&(J="@@iterator");c.doneEnumerator={done:!0,value:d},c.helpers.isIterable=function(a){return a[J]!==d},c.helpers.isArrayLike=function(a){return a&&a.length!==d};c.helpers.iterator=J;var K=function(a){function b(a,b){this.c=a,this.s=b}return z(b,a),b.prototype[J]=function(){var a=this;return{next:function(){return a.c()?{done:!1,value:a.s}:{done:!0,value:void 0}}}},b}(t);i.letBind=i.let=function(a){return a(this)},h["if"]=function(a,b,c){return m(function(){return c||(c=n()),D(b)&&(b=G(b)),D(c)&&(c=G(c)),"function"==typeof c.now&&(c=n(c)),a()?b:c})},h["for"]=h.forIn=function(a,b,c){return u(a,b,c).concat()};var L=h["while"]=h.whileDo=function(a,b){return D(b)&&(b=G(b)),g(a,b).concat()};i.doWhile=function(a){return l([this,L(a,this)])},h["case"]=function(a,b,c){return m(function(){D(c)&&(c=G(c)),c||(c=n()),F(c)&&(c=n(c));var d=b[a()];return D(d)&&(d=G(d)),d||c})},i.expand=function(a,b){F(b)||(b=v);var c=this;return new j(function(d){var e=[],f=new r,g=new p(f),h=0,i=!1,j=function(){var c=!1;e.length>0&&(c=!i,i=!0),c&&f.setDisposable(b.scheduleRecursive(null,function(b,c){var f;if(!(e.length>0))return void(i=!1);f=e.shift();var k=new s;g.add(k),k.setDisposable(f.subscribe(function(b){d.onNext(b);var c=null;try{c=a(b)}catch(f){d.onError(f)}e.push(c),h++,j()},function(a){d.onError(a)},function(){g.remove(k),h--,0===h&&d.onCompleted()})),c()}))};return e.push(c),h++,j(),g},this)},h.forkJoin=function(){var a=[];if(Array.isArray(arguments[0]))a=arguments[0];else for(var b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return new j(function(b){var c=a.length;if(0===c)return b.onCompleted(),o;for(var d=new p,e=!1,f=new Array(c),g=new Array(c),h=new Array(c),i=0;c>i;i++)!function(i){var j=a[i];D(j)&&(j=G(j)),d.add(j.subscribe(function(a){e||(f[i]=!0,h[i]=a)},function(a){e=!0,b.onError(a),d.dispose()},function(){if(!e){if(!f[i])return void b.onCompleted();g[i]=!0;for(var a=0;c>a;a++)if(!g[a])return;e=!0,b.onNext(h),b.onCompleted()}}))}(i);return d})},i.forkJoin=function(a,b){var c=this;return new j(function(d){var f,g,h=!1,i=!1,j=!1,k=!1,l=new s,m=new s;return D(a)&&(a=G(a)),l.setDisposable(c.subscribe(function(a){j=!0,f=a},function(a){m.dispose(),d.onError(a)},function(){if(h=!0,i)if(j)if(k){var a=I(b)(f,g);if(a===H)return d.onError(e);d.onNext(a),d.onCompleted()}else d.onCompleted();else d.onCompleted()})),m.setDisposable(a.subscribe(function(a){k=!0,g=a},function(a){l.dispose(),d.onError(a)},function(){if(i=!0,h)if(j)if(k){var a=I(b)(f,g);if(a===H)return d.onError(a.e);d.onNext(a),d.onCompleted()}else d.onCompleted();else d.onCompleted()})),new q(l,m)},c)},i.manySelect=i.extend=function(a,b){F(b)||(b=v);var c=this;return m(function(){var d;return c.map(function(a){var b=new M(a);return d&&d.onNext(a),d=b,b}).tap(C,function(a){d&&d.onError(a)},function(){d&&d.onCompleted()}).observeOn(b).map(a)},c)};var M=function(a){function b(b){a.call(this),this.head=b,this.tail=new x}return z(b,a),A(b.prototype,y,{_subscribe:function(a){var b=new p;return b.add(w.schedule(this,function(c,d){a.onNext(d.head),b.add(d.tail.mergeAll().subscribe(a))})),b},onCompleted:function(){this.onNext(h.empty())},onError:function(a){this.onNext(h["throw"](a))},onNext:function(a){this.tail.onNext(a),this.tail.onCompleted()}}),b}(h);return i.switchFirst=function(){var a=this;return new j(function(b){var c=!1,d=!1,e=new s,f=new p;return f.add(e),e.setDisposable(a.subscribe(function(a){if(!c){c=!0,D(a)&&(a=G(a));var e=new s;f.add(e),e.setDisposable(a.subscribe(function(a){b.onNext(a)},function(a){b.onError(a)},function(){f.remove(e),c=!1,d&&1===f.length&&b.onCompleted()}))}},function(a){b.onError(a)},function(){d=!0,!c&&1===f.length&&b.onCompleted()})),f},this)},i.flatMapFirst=i.selectManyFirst=function(a,b,c){return new k(this,a,b,c).switchFirst()},c.Observable.prototype.flatMapWithMaxConcurrent=function(a,b,c,d){return new k(this,b,c,d).merge(a)},c});
//# sourceMappingURL=rx.lite.experimental.map