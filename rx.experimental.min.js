/*** @preserve Copyright (c) Microsoft Corporation.  All rights reserved.
* This code is licensed by Microsoft Corporation under the terms
* of the MICROSOFT REACTIVE EXTENSIONS FOR JAVASCRIPT AND .NET LIBRARIES License.
* See http://go.microsoft.com/fwlink/?LinkID=220762.
*/
(function(e,t){var n=typeof exports=="object"&&exports&&(typeof e=="object"&&e&&e==e.global&&(window=e),exports);typeof define=="function"&&define.amd?define(["rx","exports"],function(n,r){return e.Rx=t(e,r,n),e.Rx}):typeof module=="object"&&module&&module.exports==n?module.exports=t(e,module.exports,require("./rx")):e.Rx=t(e,{},e.Rx)})(this,function(e,t,n,r){function w(e,t){return e.length===1&&Array.isArray(e[t])?e[t]:b.call(e)}function E(e,t){return new m(function(){var n;return v(function(){return e()?(n=t,!0):!1},function(){return n})})}var i=n.Observable,s=i.prototype,o=i.createWithDisposable,u=i.concat,a=i.defer,f=i.empty,l=n.Disposable.empty,c=n.Internals.BinaryObserver,h=n.CompositeDisposable,p=n.SerialDisposable,d=n.SingleAssignmentDisposable,v=n.Internals.Enumerator.create,m=n.Internals.Enumerable,g=m.forEach,y=n.Scheduler.immediate,b=Array.prototype.slice;s.letBind=function(e){return e(this)},i.ifThen=function(e,t,n){return a(function(){n||(n=f());if(n.now){var r=n;n=f(r)}return e()?t:n})},i.forIn=function(e,t){return g(e,t).concat()};var S=i.whileDo=function(e,t){return E(e,t).concat()};return s.doWhile=function(e){return u([this,S(e,this)])},i.switchCase=function(e,t,n){return a(function(){n||(n=f());if(n.now){var i=n;n=f(i)}var s=t[e()];return s!==r?s:n})},s.expand=function(e,t){t||(t=y);var n=this;return o(function(r){var i=[],s=new p,o=new h(s),u=0,a=!1,f=function(){var n=!1;i.length>0&&(n=!a,a=!0),n&&s.setDisposable(t.scheduleRecursive(function(t){var n;if(!(i.length>0)){a=!1;return}n=i.shift();var s=new d;o.add(s),s.setDisposable(n.subscribe(function(t){r.onNext(t);var n=null;try{n=e(t)}catch(s){r.onError(s)}i.push(n),u++,f()},r.onError.bind(r),function(){o.remove(s),u--,u===0&&r.onCompleted()})),t()}))};return i.push(n),u++,f(),o})},i.forkJoin=function(){var e=w(arguments,0);return o(function(t){var n=e.length;if(n===0)return t.onCompleted(),l;var r=new h,i=!1,s=new Array(n),o=new Array(n),u=new Array(n);for(var a=0;a<n;a++)(function(a){var f=e[a];r.add(f.subscribe(function(e){i||(s[a]=!0,u[a]=e)},function(e){i=!0,t.onError(e),r.dispose()},function(){if(!i){if(!s[a]){t.onCompleted();return}o[a]=!0;for(var e=0;e<n;e++)if(!o[e])return;i=!0,t.onNext(u),t.onCompleted()}}))})(a);return r})},s.forkJoin=function(e,t){var n=this;return o(function(r){var i=!1,s=!1,o=!1,u=!1,a,f,l=new d,c=new d;return l.setDisposable(n.subscribe(function(e){o=!0,a=e},function(e){c.dispose(),r.onError(e)},function(){i=!0;if(s)if(!o)r.onCompleted();else if(!u)r.onCompleted();else{var e;try{e=t(a,f)}catch(n){r.onError(n);return}r.onNext(e),r.onCompleted()}})),c.setDisposable(e.subscribe(function(e){u=!0,f=e},function(e){l.dispose(),r.onError(e)},function(){s=!0;if(i)if(!o)r.onCompleted();else if(!u)r.onCompleted();else{var e;try{e=t(a,f)}catch(n){r.onError(n);return}r.onNext(e),r.onCompleted()}})),new h(l,c)})},n});