/*** @preserve Copyright (c) Microsoft Corporation.  All rights reserved.
* This code is licensed by Microsoft Corporation under the terms
* of the MICROSOFT REACTIVE EXTENSIONS FOR JAVASCRIPT AND .NET LIBRARIES License.
* See http://go.microsoft.com/fwlink/?LinkID=220762.
*/
(function(e,t){var n=typeof exports=="object"&&exports&&(typeof e=="object"&&e&&e==e.global&&(window=e),exports);typeof define=="function"&&define.amd?define(["rx","exports"],function(n,r){return e.Rx=t(e,r,n),e.Rx}):typeof module=="object"&&module&&module.exports==n?module.exports=t(e,module.exports,require("./rx")):e.Rx=t(e,{},e.Rx)})(this,function(e,t,n,r){function y(){if(this.isDisposed)throw new Error(g)}var i=n.Observable,s=i.prototype,o=n.Internals.AnonymousObservable,u=n.Subject,a=n.AsyncSubject,f=n.Observer,l=n.Internals.ScheduledObserver,c=n.Disposable.create,h=n.Disposable.empty,p=n.CompositeDisposable,d=n.Scheduler.currentThread,v=n.Internals.inherits,m=n.Internals.addProperties,g="Object has been disposed";s.multicast=function(e,t){var n=this;return typeof e=="function"?new o(function(r){var i=n.multicast(e());return new p(t(i).subscribe(r),i.connect())}):new S(n,e)},s.publish=function(e){return e?this.multicast(function(){return new u},e):this.multicast(new u)},s.publishLast=function(e){return e?this.multicast(function(){return new a},e):this.multicast(new a)},s.publishValue=function(e,t){return arguments.length===2?this.multicast(function(){return new w(t)},e):this.multicast(new w(e))},s.replay=function(e,t,n,r){return e?this.multicast(function(){return new E(t,n,r)},e):this.multicast(new E(t,n,r))};var b=function(e,t){this.subject=e,this.observer=t};b.prototype.dispose=function(){if(!this.subject.isDisposed&&this.observer!==null){var e=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(e,1),this.observer=null}};var w=n.BehaviorSubject=function(){function e(e){var t;return y.call(this),this.isStopped?(t=this.exception,t?e.onError(t):e.onCompleted(),h):(this.observers.push(e),e.onNext(this.value),new b(this,e))}function t(n){t.super_.constructor.call(this,e),this.value=n,this.observers=[],this.isDisposed=!1,this.isStopped=!1,this.exception=null}return v(t,i),m(t.prototype,f,{onCompleted:function(){y.call(this);if(!this.isStopped){var e=this.observers.slice(0);this.isStopped=!0;for(var t=0,n=e.length;t<n;t++)e[t].onCompleted();this.observers=[]}},onError:function(e){y.call(this);if(!this.isStopped){var t=this.observers.slice(0);this.isStopped=!0,this.exception=e;for(var n=0,r=t.length;n<r;n++)t[n].onError(e);this.observers=[]}},onNext:function(e){y.call(this);if(!this.isStopped){this.value=e;var t=this.observers.slice(0);for(var n=0,r=t.length;n<r;n++)t[n].onNext(e)}},dispose:function(){this.isDisposed=!0,this.observers=null,this.value=null,this.exception=null}}),t}(),E=n.ReplaySubject=function(e){function n(e){var n=new l(this.scheduler,e),r=new t(this,n);y.call(this),this._trim(this.scheduler.now()),this.observers.push(n);var i=this.q.length;for(var s=0,o=this.q.length;s<o;s++)n.onNext(this.q[s].value);return this.hasError?(i++,n.onError(this.error)):this.isStopped&&(i++,n.onCompleted()),n.ensureActive(i),r}function r(e,t,i){this.bufferSize=e==null?Number.MAX_VALUE:e,this.window=t==null?Number.MAX_VALUE:t,this.scheduler=i||d,this.q=[],this.observers=[],this.isStopped=!1,this.isDisposed=!1,this.hasError=!1,this.error=null,r.super_.constructor.call(this,n)}var t=function(e,t){this.subject=e,this.observer=t};return t.prototype.dispose=function(){this.observer.dispose();if(!this.subject.isDisposed){var e=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(e,1)}},v(r,i),m(r.prototype,f,{_trim:function(e){while(this.q.length>this.bufferSize)this.q.shift();while(this.q.length>0&&e-this.q[0].interval>this.window)this.q.shift()},onNext:function(e){var t;y.call(this);if(!this.isStopped){var n=this.scheduler.now();this.q.push({interval:n,value:e}),this._trim(n);var r=this.observers.slice(0);for(var i=0,s=r.length;i<s;i++)t=r[i],t.onNext(e),t.ensureActive()}},onError:function(e){var t;y.call(this);if(!this.isStopped){this.isStopped=!0,this.error=e,this.hasError=!0;var n=this.scheduler.now();this._trim(n);var r=this.observers.slice(0);for(var i=0,s=r.length;i<s;i++)t=r[i],t.onError(e),t.ensureActive();this.observers=[]}},onCompleted:function(){var e;y.call(this);if(!this.isStopped){this.isStopped=!0;var t=this.scheduler.now();this._trim(t);var n=this.observers.slice(0);for(var r=0,i=n.length;r<i;r++)e=n[r],e.onCompleted(),e.ensureActive();this.observers=[]}},dispose:function(){this.isDisposed=!0,this.observers=null}}),r}(),S=function(){function e(t,n){var r={subject:n,source:t.asObservable(),hasSubscription:!1,subscription:null};this.connect=function(){return r.hasSubscription||(r.hasSubscription=!0,r.subscription=new p(r.source.subscribe(r.subject),c(function(){r.hasSubscription=!1}))),r.subscription};var i=function(e){return r.subject.subscribe(e)};e.super_.constructor.call(this,i)}return v(e,i),e.prototype.connect=function(){return this.connect()},e.prototype.refCount=function(){var e=null,t=0,n=this;return new o(function(r){var i,s;return t++,i=t===1,s=n.subscribe(r),i&&(e=n.connect()),c(function(){s.dispose(),t--,t===0&&e.dispose()})})},e}();return n});