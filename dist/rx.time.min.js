(function(t){var e={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},n=e[typeof window]&&window||this,r=e[typeof exports]&&exports&&!exports.nodeType&&exports,i=e[typeof module]&&module&&!module.nodeType&&module,o=(i&&i.exports===r&&r,e[typeof global]&&global);!o||o.global!==o&&o.window!==o||(n=o),"function"==typeof define&&define.amd?define(["rx","exports"],function(e,r){return n.Rx=t(n,r,e),n.Rx}):"object"==typeof module&&module&&module.exports===r?module.exports=t(n,module.exports,require("./rx")):n.Rx=t(n,{},n.Rx)}).call(this,function(t,e,n,r){function i(t,e){return new p(function(n){return e.scheduleWithAbsolute(t,function(){n.onNext(0),n.onCompleted()})})}function o(t,e,n){var r=D(e);return new p(function(e){var i=0,o=t;return n.scheduleRecursiveWithAbsolute(o,function(t){var s;r>0&&(s=n.now(),o+=r,s>=o&&(o=s+r)),e.onNext(i++),t(o)})})}function s(t,e){var n=D(t);return new p(function(t){return e.scheduleWithRelative(n,function(){t.onNext(0),t.onCompleted()})})}function u(t,e,n){return t===e?new p(function(t){return n.schedulePeriodicWithState(0,e,function(e){return t.onNext(e),e+1})}):d(function(){return o(n.now()+t,e,n)})}function c(t,e,n){return new p(function(r){var i,o=!1,s=new g,u=null,c=[],a=!1;return i=t.materialize().timestamp(n).subscribe(function(t){var i,h;"E"===t.value.kind?(c=[],c.push(t),u=t.value.exception,h=!a):(c.push({value:t.value,timestamp:t.timestamp+e}),h=!o,o=!0),h&&(null!==u?r.onError(u):(i=new w,s.setDisposable(i),i.setDisposable(n.scheduleRecursiveWithRelative(e,function(t){var e,i,s,h;if(null===u){a=!0;do s=null,c.length>0&&0>=c[0].timestamp-n.now()&&(s=c.shift().value),null!==s&&s.accept(r);while(null!==s);h=!1,i=0,c.length>0?(h=!0,i=Math.max(0,c[0].timestamp-n.now())):o=!1,e=u,a=!1,null!==e?r.onError(e):h&&t(i)}}))))}),new E(i,s)})}function a(t,e,n){return d(function(){return c(t,e-n.now(),n)})}function h(t,e){return new p(function(n){function r(){s&&(s=!1,n.onNext(o)),i&&n.onCompleted()}var i,o,s;return new E(t.subscribe(function(t){s=!0,o=t},n.onError.bind(n),function(){i=!0}),e.subscribe(r,n.onError.bind(n),r))})}var l=n.Observable,f=l.prototype,p=n.AnonymousObservable,d=l.defer,b=l.empty,v=l.never,m=l.throwException,y=(l.fromArray,n.Scheduler.timeout),w=n.SingleAssignmentDisposable,g=n.SerialDisposable,E=n.CompositeDisposable,x=n.RefCountDisposable,C=n.Subject,N=n.internals.addRef,D=n.Scheduler.normalize,S=n.helpers,A=S.isPromise,O=S.isScheduler,_=l.fromPromise;S.notDefined;var j=l.interval=function(t,e){return u(t,t,O(e)?e:y)},k=l.timer=function(t,e,n){var c;return O(n)||(n=y),e!==r&&"number"==typeof e?c=e:e!==r&&"object"==typeof e&&(n=e),t instanceof Date&&c===r?i(t.getTime(),n):t instanceof Date&&c!==r?(c=e,o(t.getTime(),c,n)):c===r?s(t,n):u(t,c,n)};return f.delay=function(t,e){return O(e)||(e=y),t instanceof Date?a(this,t.getTime(),e):c(this,t,e)},f.throttle=function(t,e){return O(e)||(e=y),this.throttleWithSelector(function(){return k(t,e)})},f.windowWithTime=function(t,e,n){var r,i=this;return null==e&&(r=t),O(n)||(n=y),"number"==typeof e?r=e:"object"==typeof e&&(r=t,n=e),new p(function(e){function o(){var t=new w,i=!1,s=!1;l.setDisposable(t),a===c?(i=!0,s=!0):c>a?i=!0:s=!0;var p=i?a:c,d=p-f;f=p,i&&(a+=r),s&&(c+=r),t.setDisposable(n.scheduleWithRelative(d,function(){var t;s&&(t=new C,h.push(t),e.onNext(N(t,u))),i&&(t=h.shift(),t.onCompleted()),o()}))}var s,u,c=r,a=t,h=[],l=new g,f=0;return s=new E(l),u=new x(s),h.push(new C),e.onNext(N(h[0],u)),o(),s.add(i.subscribe(function(t){var e,n;for(e=0,n=h.length;n>e;e++)h[e].onNext(t)},function(t){var n,r;for(n=0,r=h.length;r>n;n++)h[n].onError(t);e.onError(t)},function(){var t,n;for(t=0,n=h.length;n>t;t++)h[t].onCompleted();e.onCompleted()})),u})},f.windowWithTimeOrCount=function(t,e,n){var r=this;return O(n)||(n=y),new p(function(i){function o(e){var r=new w;timerD.setDisposable(r),r.setDisposable(n.scheduleWithRelative(t,function(){var t;e===windowId&&(c=0,t=++windowId,a.onCompleted(),a=new C,i.onNext(N(a,u)),o(t))}))}var o,s,u,c=0,a=new C;return timerD=new g,windowId=0,s=new E(timerD),u=new x(s),i.onNext(N(a,u)),o(0),s.add(r.subscribe(function(t){var n=0,r=!1;a.onNext(t),c++,c===e&&(r=!0,c=0,n=++windowId,a.onCompleted(),a=new C,i.onNext(N(a,u))),r&&o(n)},function(t){a.onError(t),i.onError(t)},function(){a.onCompleted(),i.onCompleted()})),u})},f.bufferWithTime=function(){return this.windowWithTime.apply(this,arguments).selectMany(function(t){return t.toArray()})},f.bufferWithTimeOrCount=function(t,e,n){return this.windowWithTimeOrCount(t,e,n).selectMany(function(t){return t.toArray()})},f.timeInterval=function(t){var e=this;return O(t)||(t=y),d(function(){var n=t.now();return e.map(function(e){var r=t.now(),i=r-n;return n=r,{value:e,interval:i}})})},f.timestamp=function(t){return O(t)||(t=y),this.map(function(e){return{value:e,timestamp:t.now()}})},f.sample=function(t,e){return O(e)||(e=y),"number"==typeof t?h(this,j(t,e)):h(this,t)},f.timeout=function(t,e,n){e||(e=m(Error("Timeout"))),O(n)||(n=y);var r=this,i=t instanceof Date?"scheduleWithAbsolute":"scheduleWithRelative";return new p(function(o){var s=0,u=new w,c=new g,a=!1,h=new g;c.setDisposable(u);var l=function(){var r=s;h.setDisposable(n[i](t,function(){s===r&&(A(e)&&(e=_(e)),c.setDisposable(e.subscribe(o)))}))};return l(),u.setDisposable(r.subscribe(function(t){a||(s++,o.onNext(t),l())},function(t){a||(s++,o.onError(t))},function(){a||(s++,o.onCompleted())})),new E(c,h)})},l.generateWithAbsoluteTime=function(t,e,n,i,o,s){return O(s)||(s=y),new p(function(u){var c,a,h=!0,l=!1,f=t;return s.scheduleRecursiveWithAbsolute(s.now(),function(t){l&&u.onNext(c);try{h?h=!1:f=n(f),l=e(f),l&&(c=i(f),a=o(f))}catch(s){return u.onError(s),r}l?t(a):u.onCompleted()})})},l.generateWithRelativeTime=function(t,e,n,i,o,s){return O(s)||(s=y),new p(function(u){var c,a,h=!0,l=!1,f=t;return s.scheduleRecursiveWithRelative(0,function(t){l&&u.onNext(c);try{h?h=!1:f=n(f),l=e(f),l&&(c=i(f),a=o(f))}catch(s){return u.onError(s),r}l?t(a):u.onCompleted()})})},f.delaySubscription=function(t,e){return this.delayWithSelector(k(t,O(e)?e:y),b)},f.delayWithSelector=function(t,e){var n,i,o=this;return"function"==typeof t?i=t:(n=t,i=e),new p(function(t){var e=new E,s=!1,u=function(){s&&0===e.length&&t.onCompleted()},c=new g,a=function(){c.setDisposable(o.subscribe(function(n){var o;try{o=i(n)}catch(s){return t.onError(s),r}var c=new w;e.add(c),c.setDisposable(o.subscribe(function(){t.onNext(n),e.remove(c),u()},t.onError.bind(t),function(){t.onNext(n),e.remove(c),u()}))},t.onError.bind(t),function(){s=!0,c.dispose(),u()}))};return n?c.setDisposable(n.subscribe(function(){a()},t.onError.bind(t),function(){a()})):a(),new E(c,e)})},f.timeoutWithSelector=function(t,e,n){if(1===arguments.length){e=t;var t=v()}n||(n=m(Error("Timeout")));var i=this;return new p(function(o){var s=new g,u=new g,c=new w;s.setDisposable(c);var a=0,h=!1,l=function(t){var e=a,r=function(){return a===e},i=new w;u.setDisposable(i),i.setDisposable(t.subscribe(function(){r()&&s.setDisposable(n.subscribe(o)),i.dispose()},function(t){r()&&o.onError(t)},function(){r()&&s.setDisposable(n.subscribe(o))}))};l(t);var f=function(){var t=!h;return t&&a++,t};return c.setDisposable(i.subscribe(function(t){if(f()){o.onNext(t);var n;try{n=e(t)}catch(i){return o.onError(i),r}l(n)}},function(t){f()&&o.onError(t)},function(){f()&&o.onCompleted()})),new E(s,u)})},f.throttleWithSelector=function(t){var e=this;return new p(function(n){var i,o=!1,s=new g,u=0,c=e.subscribe(function(e){var c;try{c=t(e)}catch(a){return n.onError(a),r}o=!0,i=e,u++;var h=u,l=new w;s.setDisposable(l),l.setDisposable(c.subscribe(function(){o&&u===h&&n.onNext(i),o=!1,l.dispose()},n.onError.bind(n),function(){o&&u===h&&n.onNext(i),o=!1,l.dispose()}))},function(t){s.dispose(),n.onError(t),o=!1,u++},function(){s.dispose(),o&&n.onNext(i),n.onCompleted(),o=!1,u++});return new E(c,s)})},f.skipLastWithTime=function(t,e){O(e)||(e=y);var n=this;return new p(function(r){var i=[];return n.subscribe(function(n){var o=e.now();for(i.push({interval:o,value:n});i.length>0&&o-i[0].interval>=t;)r.onNext(i.shift().value)},r.onError.bind(r),function(){for(var n=e.now();i.length>0&&n-i[0].interval>=t;)r.onNext(i.shift().value);r.onCompleted()})})},f.takeLastWithTime=function(t,e){var n=this;return O(e)||(e=y),new p(function(r){var i=[];return n.subscribe(function(n){var r=e.now();for(i.push({interval:r,value:n});i.length>0&&r-i[0].interval>=t;)i.shift()},r.onError.bind(r),function(){for(var n=e.now();i.length>0;){var o=i.shift();t>=n-o.interval&&r.onNext(o.value)}r.onCompleted()})})},f.takeLastBufferWithTime=function(t,e){var n=this;return O(e)||(e=y),new p(function(r){var i=[];return n.subscribe(function(n){var r=e.now();for(i.push({interval:r,value:n});i.length>0&&r-i[0].interval>=t;)i.shift()},r.onError.bind(r),function(){for(var n=e.now(),o=[];i.length>0;){var s=i.shift();t>=n-s.interval&&o.push(s.value)}r.onNext(o),r.onCompleted()})})},f.takeWithTime=function(t,e){var n=this;return O(e)||(e=y),new p(function(r){return new E(e.scheduleWithRelative(t,r.onCompleted.bind(r)),n.subscribe(r))})},f.skipWithTime=function(t,e){var n=this;return O(e)||(e=y),new p(function(r){var i=!1;return new E(e.scheduleWithRelative(t,function(){i=!0}),n.subscribe(function(t){i&&r.onNext(t)},r.onError.bind(r),r.onCompleted.bind(r)))})},f.skipUntilWithTime=function(t,e){O(e)||(e=y);var n=this,r=t instanceof Date?"scheduleWithAbsolute":"scheduleWithRelative";return new p(function(i){var o=!1;return new E(e[r](t,function(){o=!0}),n.subscribe(function(t){o&&i.onNext(t)},i.onError.bind(i),i.onCompleted.bind(i)))})},f.takeUntilWithTime=function(t,e){O(e)||(e=y);var n=this,r=t instanceof Date?"scheduleWithAbsolute":"scheduleWithRelative";return new p(function(i){return new E(e[r](t,function(){i.onCompleted()}),n.subscribe(i))})},n});