/* Copyright (c) Microsoft Open Technologies, Inc. All rights reserved. See License.txt in the project root for license information.*/
(function(a){var b={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},c=b[typeof window]&&window||this,d=b[typeof exports]&&exports&&!exports.nodeType&&exports,e=b[typeof module]&&module&&!module.nodeType&&module,f=(e&&e.exports===d&&d,b[typeof global]&&global);!f||f.global!==f&&f.window!==f||(c=f),"function"==typeof define&&define.amd?define(["rx"],function(b,d){return a(c,d,b)}):"object"==typeof module&&module&&module.exports===d?module.exports=a(c,module.exports,require("./rx")):c.Rx=a(c,{},c.Rx)}).call(this,function(a,b,c,d){function e(){try{return h.apply(this,arguments)}catch(a){return z.e=a,z}}function f(a){if(!y(a))throw new TypeError("fn must be a function");return h=a,e}function g(a,b,c){return new k(function(d){function e(a,b){if(k[b]=a,h[b]=!0,i||(i=h.every(w))){if(g)return d.onError(g);var e=f(c).apply(null,k);if(e===z)return d.onError(e.e);d.onNext(e)}j&&k[1]&&d.onCompleted()}var g,h=[!1,!1],i=!1,j=!1,k=new Array(2);return new m(a.subscribe(function(a){e(a,0)},function(a){k[1]?d.onError(a):g=a},function(){j=!0,k[1]&&d.onCompleted()}),b.subscribe(function(a){e(a,1)},function(a){d.onError(a)},function(){j=!0,e(!0,1)}))},a)}var h,i=c.Observable,j=i.prototype,k=c.AnonymousObservable,l=c.internals.AbstractObserver,m=c.CompositeDisposable,n=c.Notification,o=c.Subject,p=c.Observer,q=c.Disposable.empty,r=c.Disposable.create,s=c.internals.inherits,t=c.internals.addProperties,u=c.Scheduler.timeout,v=c.Scheduler.currentThread,w=c.helpers.identity,x=c.Scheduler.isScheduler,y=c.helpers.isFunction,z=(c.Disposable.checkDisposed,{e:{}});c.Pauser=function(a){function b(){a.call(this)}return s(b,a),b.prototype.pause=function(){this.onNext(!1)},b.prototype.resume=function(){this.onNext(!0)},b}(o);var A=function(a){function b(a){var b=this.source.publish(),c=b.subscribe(a),d=q,e=this.pauser.distinctUntilChanged().subscribe(function(a){a?d=b.connect():(d.dispose(),d=q)});return new m(c,d,e)}function c(c,d){this.source=c,this.controller=new o,d&&d.subscribe?this.pauser=this.controller.merge(d):this.pauser=this.controller,a.call(this,b,c)}return s(c,a),c.prototype.pause=function(){this.controller.onNext(!1)},c.prototype.resume=function(){this.controller.onNext(!0)},c}(i);j.pausable=function(a){return new A(this,a)};var B=function(a){function b(a){function b(){for(;e.length>0;)a.onNext(e.shift())}var c,e=[],f=g(this.source,this.pauser.distinctUntilChanged().startWith(!1),function(a,b){return{data:a,shouldFire:b}}).subscribe(function(f){c!==d&&f.shouldFire!=c?(c=f.shouldFire,f.shouldFire&&b()):(c=f.shouldFire,f.shouldFire?a.onNext(f.data):e.push(f.data))},function(c){b(),a.onError(c)},function(){b(),a.onCompleted()});return f}function c(c,d){this.source=c,this.controller=new o,d&&d.subscribe?this.pauser=this.controller.merge(d):this.pauser=this.controller,a.call(this,b,c)}return s(c,a),c.prototype.pause=function(){this.controller.onNext(!1)},c.prototype.resume=function(){this.controller.onNext(!0)},c}(i);j.pausableBuffered=function(a){return new B(this,a)};var C=function(a){function b(a){return this.source.subscribe(a)}function c(c,d,e){a.call(this,b,c),this.subject=new D(d,e),this.source=c.multicast(this.subject).refCount()}return s(c,a),c.prototype.request=function(a){return this.subject.request(null==a?-1:a)},c}(i),D=function(a){function b(a){return this.subject.subscribe(a)}function c(c,d){null==c&&(c=!0),a.call(this,b),this.subject=new o,this.enableQueue=c,this.queue=c?[]:null,this.requestedCount=0,this.requestedDisposable=q,this.error=null,this.hasFailed=!1,this.hasCompleted=!1,this.scheduler=d||v}return s(c,a),t(c.prototype,p,{onCompleted:function(){this.hasCompleted=!0,this.enableQueue&&0!==this.queue.length?this.queue.push(n.createOnCompleted()):this.subject.onCompleted()},onError:function(a){this.hasFailed=!0,this.error=a,this.enableQueue&&0!==this.queue.length?this.queue.push(n.createOnError(a)):this.subject.onError(a)},onNext:function(a){var b=!1;0===this.requestedCount?this.enableQueue&&this.queue.push(n.createOnNext(a)):(-1!==this.requestedCount&&0===this.requestedCount--&&this.disposeCurrentRequest(),b=!0),b&&this.subject.onNext(a)},_processRequest:function(a){if(this.enableQueue){for(;this.queue.length>=a&&a>0||this.queue.length>0&&"N"!==this.queue[0].kind;){var b=this.queue.shift();b.accept(this.subject),"N"===b.kind?a--:(this.disposeCurrentRequest(),this.queue=[])}return{numberOfItems:a,returnValue:0!==this.queue.length}}return{numberOfItems:a,returnValue:!1}},request:function(a){this.disposeCurrentRequest();var b=this;return this.requestedDisposable=this.scheduler.scheduleWithState(a,function(a,c){var d=b._processRequest(c),e=d.numberOfItems;d.returnValue||(b.requestedCount=e,b.requestedDisposable=r(function(){b.requestedCount=0}))}),this.requestedDisposable},disposeCurrentRequest:function(){this.requestedDisposable.dispose(),this.requestedDisposable=q}}),c}(i);j.controlled=function(a,b){return a&&x(a)&&(b=a,a=!0),null==a&&(a=!0),new C(this,a,b)};var E=function(a){function b(a){this.subscription=this.source.subscribe(new d(a,this,this.subscription));var b=this;return u.schedule(function(){b.source.request(1)}),this.subscription}function c(c){a.call(this,b,c),this.source=c}s(c,a);var d=function(a){function b(b,c,d){a.call(this),this.observer=b,this.observable=c,this.cancel=d}s(b,a);var c=b.prototype;return c.completed=function(){this.observer.onCompleted(),this.dispose()},c.error=function(a){this.observer.onError(a),this.dispose()},c.next=function(a){this.observer.onNext(a);var b=this;u.schedule(function(){b.observable.source.request(1)})},c.dispose=function(){this.observer=null,this.cancel&&(this.cancel.dispose(),this.cancel=null),a.prototype.dispose.call(this)},b}(l);return c}(i);C.prototype.stopAndWait=function(){return new E(this)};var F=function(a){function b(a){this.subscription=this.source.subscribe(new d(a,this,this.subscription));var b=this;return u.schedule(function(){b.source.request(b.windowSize)}),this.subscription}function c(c,d){a.call(this,b,c),this.source=c,this.windowSize=d}s(c,a);var d=function(a){function b(a,b,c){this.observer=a,this.observable=b,this.cancel=c,this.received=0}s(b,a);var c=b.prototype;return c.completed=function(){this.observer.onCompleted(),this.dispose()},c.error=function(a){this.observer.onError(a),this.dispose()},c.next=function(a){if(this.observer.onNext(a),this.received=++this.received%this.observable.windowSize,0===this.received){var b=this;u.schedule(function(){b.observable.source.request(b.observable.windowSize)})}},c.dispose=function(){this.observer=null,this.cancel&&(this.cancel.dispose(),this.cancel=null),a.prototype.dispose.call(this)},b}(l);return c}(i);return C.prototype.windowed=function(a){return new F(this,a)},c});
//# sourceMappingURL=rx.backpressure.map