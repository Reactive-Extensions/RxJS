(function(a){var b={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},c=b[typeof window]&&window||this,d=b[typeof exports]&&exports&&!exports.nodeType&&exports,e=b[typeof module]&&module&&!module.nodeType&&module,f=(e&&e.exports===d&&d,b[typeof global]&&global);!f||f.global!==f&&f.window!==f||(c=f),"function"==typeof define&&define.amd?define(["rx","exports"],function(b,d){return c.Rx=a(c,d,b),c.Rx}):"object"==typeof module&&module&&module.exports===d?module.exports=a(c,module.exports,require("./rx")):c.Rx=a(c,{},c.Rx)}).call(this,function(a,b,c,d){function e(){}function f(a,b){return a===b}function g(a){if(a&!1)return 2===a;for(var b=Math.sqrt(a),c=3;b>=c;){if(a%c===0)return!1;c+=2}return!0}function h(a){var b,c,d;for(b=0;b<y.length;++b)if(c=y[b],c>=a)return c;for(d=1|a;d<y[y.length-1];){if(g(d))return d;d+=2}return a}function i(a){var b=757602046;if(!a.length)return b;for(var c=0,d=a.length;d>c;c++){var e=a.charCodeAt(c);b=(b<<5)-b+e,b&=b}return b}function j(a){var b=668265261;return a=61^a^a>>>16,a+=a<<3,a^=a>>>4,a*=b,a^=a>>>15}function k(){return{key:null,value:null,next:0,hashCode:0}}function l(a,b){return a.groupJoin(this,b,function(){return v()},function(a,b){return b})}function m(a){var b=this;return new w(function(c){var d=new t,e=new p,f=new q(e);return c.onNext(x(d,f)),e.add(b.subscribe(function(a){d.onNext(a)},function(a){d.onError(a),c.onError(a)},function(){d.onCompleted(),c.onCompleted()})),e.add(a.subscribe(function(){d.onCompleted(),d=new t,c.onNext(x(d,f))},function(a){d.onError(a),c.onError(a)},function(){d.onCompleted(),c.onCompleted()})),f})}function n(a){var b=this;return new w(function(c){var d,f=new s,g=new p(f),h=new q(g),i=new t;return c.onNext(x(i,h)),g.add(b.subscribe(function(a){i.onNext(a)},function(a){i.onError(a),c.onError(a)},function(){i.onCompleted(),c.onCompleted()})),d=function(){var b,g;try{g=a()}catch(j){return c.onError(j),void 0}b=new r,f.setDisposable(b),b.setDisposable(g.take(1).subscribe(e,function(a){i.onError(a),c.onError(a)},function(){i.onCompleted(),i=new t,c.onNext(x(i,h)),d()}))},d(),h})}var o=c.Observable,p=c.CompositeDisposable,q=c.RefCountDisposable,r=c.SingleAssignmentDisposable,s=c.SerialDisposable,t=c.Subject,u=o.prototype,v=o.empty,w=c.Internals.AnonymousObservable,x=(c.Observer.create,c.Internals.addRef),y=[1,3,7,13,31,61,127,251,509,1021,2039,4093,8191,16381,32749,65521,131071,262139,524287,1048573,2097143,4194301,8388593,16777213,33554393,67108859,134217689,268435399,536870909,1073741789,2147483647],z="no such key",A="duplicate key",B=function(){var a=0;return function(b){if(null==b)throw new Error(z);if("string"==typeof b)return i(b);if("number"==typeof b)return j(b);if("boolean"==typeof b)return b===!0?1:0;if(b instanceof Date)return b.getTime();if(b.getHashCode)return b.getHashCode();var c=17*a++;return b.getHashCode=function(){return c},c}}(),C=function(a,b){if(0>a)throw new Error("out of range");a>0&&this._initialize(a),this.comparer=b||f,this.freeCount=0,this.size=0,this.freeList=-1};return C.prototype._initialize=function(a){var b,c=h(a);for(this.buckets=new Array(c),this.entries=new Array(c),b=0;c>b;b++)this.buckets[b]=-1,this.entries[b]=k();this.freeList=-1},C.prototype.count=function(){return this.size},C.prototype.add=function(a,b){return this._insert(a,b,!0)},C.prototype._insert=function(a,b,c){this.buckets||this._initialize(0);for(var d,e=2147483647&B(a),f=e%this.buckets.length,g=this.buckets[f];g>=0;g=this.entries[g].next)if(this.entries[g].hashCode===e&&this.comparer(this.entries[g].key,a)){if(c)throw new Error(A);return this.entries[g].value=b,void 0}this.freeCount>0?(d=this.freeList,this.freeList=this.entries[d].next,--this.freeCount):(this.size===this.entries.length&&(this._resize(),f=e%this.buckets.length),d=this.size,++this.size),this.entries[d].hashCode=e,this.entries[d].next=this.buckets[f],this.entries[d].key=a,this.entries[d].value=b,this.buckets[f]=d},C.prototype._resize=function(){var a=h(2*this.size),b=new Array(a);for(d=0;d<b.length;++d)b[d]=-1;var c=new Array(a);for(d=0;d<this.size;++d)c[d]=this.entries[d];for(var d=this.size;a>d;++d)c[d]=k();for(var e=0;e<this.size;++e){var f=c[e].hashCode%a;c[e].next=b[f],b[f]=e}this.buckets=b,this.entries=c},C.prototype.remove=function(a){if(this.buckets)for(var b=2147483647&B(a),c=b%this.buckets.length,d=-1,e=this.buckets[c];e>=0;e=this.entries[e].next){if(this.entries[e].hashCode===b&&this.comparer(this.entries[e].key,a))return 0>d?this.buckets[c]=this.entries[e].next:this.entries[d].next=this.entries[e].next,this.entries[e].hashCode=-1,this.entries[e].next=this.freeList,this.entries[e].key=null,this.entries[e].value=null,this.freeList=e,++this.freeCount,!0;d=e}return!1},C.prototype.clear=function(){var a,b;if(!(this.size<=0)){for(a=0,b=this.buckets.length;b>a;++a)this.buckets[a]=-1;for(a=0;a<this.size;++a)this.entries[a]=k();this.freeList=-1,this.size=0}},C.prototype._findEntry=function(a){if(this.buckets)for(var b=2147483647&B(a),c=this.buckets[b%this.buckets.length];c>=0;c=this.entries[c].next)if(this.entries[c].hashCode===b&&this.comparer(this.entries[c].key,a))return c;return-1},C.prototype.count=function(){return this.size-this.freeCount},C.prototype.tryGetValue=function(a){var b=this._findEntry(a);return b>=0?this.entries[b].value:d},C.prototype.getValues=function(){var a=0,b=[];if(this.entries)for(var c=0;c<this.size;c++)this.entries[c].hashCode>=0&&(b[a++]=this.entries[c].value);return b},C.prototype.get=function(a){var b=this._findEntry(a);if(b>=0)return this.entries[b].value;throw new Error(z)},C.prototype.set=function(a,b){this._insert(a,b,!1)},C.prototype.containskey=function(a){return this._findEntry(a)>=0},u.join=function(a,b,c,d){var f=this;return new w(function(g){var h=new p,i=!1,j=0,k=new C,l=!1,m=0,n=new C;return h.add(f.subscribe(function(a){var c,f,l,m,o=j++,p=new r;k.add(o,a),h.add(p),f=function(){return k.remove(o)&&0===k.count()&&i&&g.onCompleted(),h.remove(p)};try{c=b(a)}catch(q){return g.onError(q),void 0}p.setDisposable(c.take(1).subscribe(e,g.onError.bind(g),function(){f()})),m=n.getValues();for(var s=0;s<m.length;s++){try{l=d(a,m[s])}catch(t){return g.onError(t),void 0}g.onNext(l)}},g.onError.bind(g),function(){i=!0,(l||0===k.count())&&g.onCompleted()})),h.add(a.subscribe(function(a){var b,f,i,j,o=m++,p=new r;n.add(o,a),h.add(p),f=function(){return n.remove(o)&&0===n.count()&&l&&g.onCompleted(),h.remove(p)};try{b=c(a)}catch(q){return g.onError(q),void 0}p.setDisposable(b.take(1).subscribe(e,g.onError.bind(g),function(){f()})),j=k.getValues();for(var s=0;s<j.length;s++){try{i=d(j[s],a)}catch(q){return g.onError(q),void 0}g.onNext(i)}},g.onError.bind(g),function(){l=!0,(i||0===n.count())&&g.onCompleted()})),h})},u.groupJoin=function(a,b,c,d){var e=this;return new w(function(f){var g=function(){},h=new p,i=new q(h),j=new C,k=new C,l=0,m=0;return h.add(e.subscribe(function(a){var c=new t,e=l++;j.add(e,c);var m,n,o,p,q;try{q=d(a,x(c,i))}catch(s){for(o=j.getValues(),m=0,n=o.length;n>m;m++)o[m].onError(s);return f.onError(s),void 0}for(f.onNext(q),p=k.getValues(),m=0,n=p.length;n>m;m++)c.onNext(p[m]);var u=new r;h.add(u);var v,w=function(){j.remove(e)&&c.onCompleted(),h.remove(u)};try{v=b(a)}catch(s){for(o=j.getValues(),m=0,n=j.length;n>m;m++)o[m].onError(s);return f.onError(s),void 0}u.setDisposable(v.take(1).subscribe(g,function(a){for(o=j.getValues(),m=0,n=o.length;n>m;m++)o[m].onError(a);f.onError(a)},w))},function(a){for(var b=j.getValues(),c=0,d=b.length;d>c;c++)b[c].onError(a);f.onError(a)},f.onCompleted.bind(f))),h.add(a.subscribe(function(a){var b,d,e,i=m++;k.add(i,a);var l=new r;h.add(l);var n,o=function(){k.remove(i),h.remove(l)};try{n=c(a)}catch(p){for(b=j.getValues(),d=0,e=j.length;e>d;d++)b[d].onError(p);return f.onError(p),void 0}for(l.setDisposable(n.take(1).subscribe(g,function(a){for(b=j.getValues(),d=0,e=j.length;e>d;d++)b[d].onError(a);f.onError(a)},o)),b=j.getValues(),d=0,e=b.length;e>d;d++)b[d].onNext(a)},function(a){for(var b=j.getValues(),c=0,d=b.length;d>c;c++)b[c].onError(a);f.onError(a)})),i})},u.buffer=function(){return this.window.apply(this,arguments).selectMany(function(a){return a.toArray()})},u.window=function(a,b){return 1===arguments.length&&"function"!=typeof arguments[0]?m.call(this,a):"function"==typeof a?n.call(this,a):l.call(this,a,b)},c});